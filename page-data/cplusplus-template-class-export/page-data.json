{"componentChunkName":"component---src-templates-blog-post-js","path":"/cplusplus-template-class-export/","result":{"data":{"site":{"siteMetadata":{"title":"Hi, aphage"}},"markdownRemark":{"id":"6f8a067b-1aa1-517f-ab82-07fb0a7872b6","excerpt":"c++ template class export c++ 模板类导出 The focus is on  重点是  template function export 模板函数导出 class export 类导出 warning C4251 https://docs.microsoft.com/en-us/cpp…","html":"<h1>c++ template class export</h1>\n<p>c++ 模板类导出</p>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">template&lt;typename T&gt;\nclass __declspec(dllexport) Hello3 {\n\npublic:\n\tHello3(std::string&amp;&amp; name) {\n\t\tthis-&gt;name = name;\n\t}\n\n\tvoid Say(T v) {\n\t\tstd::cout &lt;&lt; name &lt;&lt; &quot;: &quot; &lt;&lt; v &lt;&lt; std::endl;\n\t}\n\nprivate:\n\tstd::string name;\n};\n\n//Explicit instantiation\ntemplate class Hello3&lt;std::string&gt;;\ntemplate class __declspec(dllexport) Hello3&lt;int&gt;;\n//__declspec(dllexport) can be written on the CLASS or here\n//__declspec(dllexport) 可以写在 CLASS 上或在这里</code></pre></div>\n<p>The focus is on <code class=\"language-text\">Explicit instantiation</code></p>\n<p>重点是 <code class=\"language-text\">Explicit instantiation</code></p>\n<!--more-->\n<h2>template function export</h2>\n<p>模板函数导出</p>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">//__declspec(dllexport) cannot be written here\n//这里不能写 __declspec(dllexport)\ntemplate&lt;typename T&gt;\nT Echo(T&amp;&amp; v) {\n\tstd::cout &lt;&lt; &quot;Echo: &quot; &lt;&lt; v &lt;&lt; std::endl;\n\treturn v;\n}\n\n//Explicit instantiation\ntemplate __declspec(dllexport) int Echo(int&amp;&amp;);\ntemplate __declspec(dllexport) double Echo(double&amp;&amp;);</code></pre></div>\n<h2>class export</h2>\n<p>类导出</p>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">class __declspec(dllexport) Hello {\n\npublic:\n\tHello(std::string&amp;&amp; name) {\n\t\tthis-&gt;name = name;\n\t}\n\n\tvoid Say(std::string&amp;&amp; s) {\n\t\tstd::cout &lt;&lt; name &lt;&lt; &quot;: &quot; &lt;&lt; s &lt;&lt; std::endl;\n\t}\n\nprivate:\n\tstd::string name;\n};\n\nclass Hello2 {\n\npublic:\n\t__declspec(dllexport)\tHello2(std::string&amp;&amp; name) {\n\t\tthis-&gt;name = name;\n\t}\n\t__declspec(dllexport) ~Hello2() {\n\n\t}\n\n\t__declspec(dllexport) void Say(std::string&amp;&amp; s) {\n\t\tstd::cout &lt;&lt; name &lt;&lt; &quot;: &quot; &lt;&lt; s &lt;&lt; std::endl;\n\t}\n\nprivate:\n\tstd::string name;\n};</code></pre></div>\n<h2>warning C4251</h2>\n<p><a href=\"https://docs.microsoft.com/en-us/cpp/error-messages/compiler-warnings/compiler-warning-level-1-c4251?view=vs-2019\">https://docs.microsoft.com/en-us/cpp/error-messages/compiler-warnings/compiler-warning-level-1-c4251?view=vs-2019</a></p>\n<p>The implementation version may be inconsistent, such <code class=\"language-text\">std::string</code> </p>\n<p>可能实现版本不一致, 比如 <code class=\"language-text\">std::string</code> </p>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">// C4251.cpp\n// compile with: /EHsc /MTd /W2 /c\n#include &lt;vector&gt;\nusing namespace std;\nclass Node;\nclass __declspec(dllexport) VecWrapper : vector&lt;Node *&gt; {};   // C4251</code></pre></div>\n<p>The solution have</p>\n<p>解决方式有</p>\n<p>Export the used template classes, and also export the dependencies</p>\n<p>把用到的模板类也导出，依赖也要导出</p>\n<p>Yourself Instantiate in the constructor</p>\n<p>在构造函数中自己实例化</p>\n<p>like this: </p>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">class EXPORT Hello4 {\n\npublic:\n\tHello4(const char* name) {\n\t\tthis-&gt;name = new std::string(name);\n\t}\n\t~Hello4() {\n\t\tdelete this-&gt;name;\n\t}\n\nprivate:\n\tstd::string* name;\n};</code></pre></div>\n<h2>demo</h2>\n<p><a href=\"https://github.com/aphage/demo/tree/master/c-cplusplus/cplusplus-class-export\">https://github.com/aphage/demo/tree/master/c-cplusplus/cplusplus-class-export</a></p>\n<div class=\"gatsby-highlight\" data-language=\"c++\"><pre class=\"language-c++\"><code class=\"language-c++\">#include &lt;iostream&gt;\n#include &lt;string&gt;\n\n#ifdef MAKEDLL\n#  define EXPORT __declspec(dllexport)\n#else\n#  define EXPORT __declspec(dllimport)\n#endif\n\n\nclass EXPORT Hello {\n\npublic:\n\tHello(std::string&amp;&amp; name);\n\n\tvoid Say(std::string&amp;&amp; s);\n\nprivate:\n\tstd::string name;\n};\n\nclass Hello2 {\n\npublic:\n\tEXPORT\tHello2(std::string&amp;&amp; name);\n\tEXPORT ~Hello2();\n\n\tEXPORT void Say(std::string&amp;&amp; s);\n\nprivate:\n\tstd::string name;\n};\n\ntemplate&lt;typename T&gt;\nclass EXPORT Hello3 {\n\npublic:\n\tHello3(std::string&amp;&amp; name);\n\n\tvoid Say(T v);\n\nprivate:\n\tstd::string name;\n};\n\ntemplate&lt;typename T&gt;\nEXPORT T Echo(T&amp;&amp; v);\n\n\nclass EXPORT Hello4 {\n\npublic:\n\tHello4(const char* name);\n\t~Hello4();\n\n\tvoid Say(const char* s);\n\nprivate:\n\tstd::string* name;\n};\n\n#pragma comment(lib,&quot;./../Debug/hello-aphage.lib&quot;)\n\nint main() {\n\tHello hello(&quot;aphage&quot;);\n\thello.Say(&quot;aqua suki&quot;);\n\n\tHello2 hello2(&quot;aphage&quot;);\n\thello2.Say(&quot;alice suki,alice foo foo~&quot;);\n\n\tHello3&lt;std::string&gt; hello3(&quot;aphage&quot;);\n\thello3.Say(&quot;aqua suki&quot;);\n\n\tHello3&lt;int&gt; hello31(&quot;aphage&quot;);\n\thello31.Say(1);\n\n\t//error, No explicit instantiation\n\t//Hello3&lt;char&gt; hello31(&quot;aphage&quot;);\n\t//hello31.Say(1);\n\n\tEcho&lt;int&gt;(2233);\n\n\tHello4 hello4(&quot;aphage&quot;);\n\thello4.Say(&quot;aqua suki&quot;);\n\n\t//https://docs.microsoft.com/en-us/cpp/error-messages/compiler-warnings/compiler-warning-level-1-c4251?view=vs-2019\n\n\treturn 0;\n}</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0ae286e8352a4e8b5818cae26bf5d872/f793b/TIM20200425162533.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 33.54430379746836%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+UlEQVQoz52RzWqEMBRGRUVQwZUL/5MYMxN1RualWvoKblwIuuu88tebDA6lhdJ2ccjNhXvuF+Loq4YeR5yVgmwFmoaBMYaqrlCWpaWqKhRF8SNZnmG6TXBU30GNF1yGHlp1EJxBCI7Xlzes64plWTDPs633fce2bd84+vf7OwkHEg4DdE9JtYaSEpxzTNcJIyXvug55nqOua5vE1F+xKXNKmWUPodQ91PlEw0bG7HCapojjGK7rwnGc33MiYasFZC/AO0ZwK0ySBFEUIQxDeJ73gORmwfNOuJ96drkRSnqWkOZDGosR+r7/t2QHLYkEF0/RcQZB8C/hByQPvHho7vdPAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"I am a image\"\n        title=\"I am a image\"\n        src=\"/static/0ae286e8352a4e8b5818cae26bf5d872/f058b/TIM20200425162533.png\"\n        srcset=\"/static/0ae286e8352a4e8b5818cae26bf5d872/c26ae/TIM20200425162533.png 158w,\n/static/0ae286e8352a4e8b5818cae26bf5d872/6bdcf/TIM20200425162533.png 315w,\n/static/0ae286e8352a4e8b5818cae26bf5d872/f058b/TIM20200425162533.png 630w,\n/static/0ae286e8352a4e8b5818cae26bf5d872/40601/TIM20200425162533.png 945w,\n/static/0ae286e8352a4e8b5818cae26bf5d872/78612/TIM20200425162533.png 1260w,\n/static/0ae286e8352a4e8b5818cae26bf5d872/f793b/TIM20200425162533.png 1404w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><a href=\"https://github.com/aphage/demo/tree/master/c-cplusplus/cplusplus-class-export\">https://github.com/aphage/demo/tree/master/c-cplusplus/cplusplus-class-export</a></p>","frontmatter":{"title":"c++ template class export","date":"March 29, 2020","description":null}},"previous":{"fields":{"slug":"/boost-build-for-vs2019/"},"frontmatter":{"title":"boost build for vs2019"}},"next":{"fields":{"slug":"/vs-build-shellcode-settings/"},"frontmatter":{"title":"vs生成shellcode设置"}}},"pageContext":{"id":"6f8a067b-1aa1-517f-ab82-07fb0a7872b6","previousPostId":"53ae3833-51a3-5e71-bfd7-817b2ab25bf4","nextPostId":"208f5ced-6849-5c8c-a41f-75a891225030"}},"staticQueryHashes":["2841359383","916993862"]}